---
---

<div class="scroll-progress-root" aria-hidden="true">
  <div class="scroll-progress-bar"></div>
</div>

<style>
  .scroll-progress-root {
    position: fixed;
    inset: 0 0 auto 0;
    height: 3px;
    z-index: 50;
    pointer-events: none;
    background: transparent;
  }

  .scroll-progress-bar {
    width: 100%;
    height: 100%;
    transform-origin: left center;
    transform: scaleX(0);
    background: linear-gradient(90deg, #ffb74d, #f57c00);
    box-shadow: 0 0 6px rgba(0, 0, 0, 0.25);
    transition: transform 0.08s ease-out;
  }

  @media (max-width: 640px) {
    .scroll-progress-root {
      height: 2px;
    }
  }
</style>

<script>
  if (typeof window !== 'undefined') {
    const bar = document.querySelector('.scroll-progress-bar');

    if (bar) {
      let ticking = false;

      const updateProgress = () => {
        const doc = document.documentElement;
        const scrollTop = window.scrollY || doc.scrollTop || 0;
        const scrollHeight = doc.scrollHeight - window.innerHeight;
        const progress = scrollHeight > 0 ? scrollTop / scrollHeight : 0;

        bar.style.transform = `scaleX(${Math.min(Math.max(progress, 0), 1)})`;
        ticking = false;
      };

      const requestTick = () => {
        if (!ticking) {
          ticking = true;
          window.requestAnimationFrame(updateProgress);
        }
      };

      window.addEventListener('scroll', requestTick, { passive: true });
      window.addEventListener('resize', requestTick);

      const cleanup = () => {
        window.removeEventListener('scroll', requestTick);
        window.removeEventListener('resize', requestTick);
        document.removeEventListener('astro:before-swap', cleanup);
      };

      document.addEventListener('astro:before-swap', cleanup);

      // 初期描画
      updateProgress();
    }
  }
</script>


